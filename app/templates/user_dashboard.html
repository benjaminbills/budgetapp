{% extends 'base.html'%}


{% block content %}
<div class="container pt-4">
  <form method="POST">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
    <label for="description">Description</label>
    {{form.description(class_='form-control')}}
    <label for="category">Category</label>
    {{form.category(class_='form-control')}}
    <label for="amount">Amount</label>
    {{form.ammount(class_='form-control')}}
    <label for="date">Date</label>
    {{form.date(class_='form-control',type='date')}}
    {{form.submit}}
  </form>
  <div class="pt-4">
    <botton class="btn btn-secondary">
      <a href="{{url_for('main.update_salary',username=user.username)}}">Add Salary</a>
    </botton>
    {% if user.salary %}
    <botton class="btn btn-secondary">
      Monthly Income: {{user.salary}}
    </botton>
    {%endif%}
    <botton class="btn btn-secondary">
      Total Amount Left: {{total_amount_left}}
    </botton>
  </div>
</div>
<hr>
<div class="container pt-3">
  <table class="table table-striped">
    <tbody>
      {% for expense in expenses %}
      <tr>
        <td>{{expense.description}}</td>
        <td>{{expense.category}}</td>
        <td>{{expense.date.strftime('%Y-%m-%d')}}</td>
        <td>ksh {{expense.ammount}}</td>
        <td><a href="{{url_for('main.delete_expense', id = expense.id, username=user.username)}}"><i class="far fa-trash-alt"></i></a></td>
      </tr>
      {% endfor %}
      {% if check_length != 0%}
      <tr>
        <td colspan="3">Total Expenses</td>
        <td class="table-active">ksh {{total_expenses}}</td>
      </tr>
      {%endif%}
    </tbody>
  </table>
</div>
{% if check_length != 0%}
<div class="container">
  <canvas id="lineChart" width="900" height="400"></canvas>
</div>
{%endif%}
{% if check_length != 0%}
<div class="container pt-3">
  <canvas id="doughnutChart" width="900" height="400"></canvas>
</div>
{%endif%}
{% endblock%}
{% block script %}
<script>
  var ctx = document.getElementById('lineChart').getContext('2d');
  var lineChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: {{dates_label | safe}},
      datasets: [
        {
          label: 'Amount/day',
          data: {{over_time_expenditure | safe}},
          fill: false,
          borderColor: 'rgb(75,192,192)',
          lineTension:0.1
        }
      ]
    },
    options: {
      responsive:true
    }
  });
  var ctx = document.getElementById('doughnutChart').getContext('2d');
  var doughnutChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: {{category_list | safe}},
      datasets: [
        {
          label: 'Salary Data',
          data: {{category_amount | safe}},
          backgroundColor: [
            'rgb(75,192,192)',
            'rgb(0, 255, 128)',
            'rgb(255, 205, 86)',
            'rgb(0, 51, 25)',
            'rgb(0, 153, 76)',
            'rgb(160, 160, 160)',
            'rgb(204, 255, 229)'
        ],
        hoverOffset:4
        }
      ]
    },
    options: {
      responsive:true
    }
  });
</script>
{% endblock %}